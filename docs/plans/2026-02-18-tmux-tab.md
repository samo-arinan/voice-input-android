# TMUX Tab Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** INPUT タブを TMUX タブに置き換え。リモート tmux 表示・キー送信・ntfy.sh 承認通知を実装する。

**Architecture:** FlickKeyboard 関連を全削除し、TAB_INPUT を TAB_TMUX にリネーム。新しい TmuxView で tmux 出力の定期ポーリング表示と `tmux send-keys` によるキー送信を行う。ntfy.sh の SSE エンドポイントを OkHttp で購読し、通知受信時にタブに緑丸明滅アニメーションを表示する。

**Tech Stack:** JSch (SSH), OkHttp (SSE), Android View (programmatic + XML), Handler/Runnable (polling)

**Design doc:** `docs/plans/2026-02-18-tmux-tab-design.md`

---

### Task 1: Delete FlickKeyboard and rename TAB_INPUT → TAB_TMUX

**Files:**
- Delete: `app/src/main/java/com/example/voiceinput/FlickKeyboardView.kt`
- Delete: `app/src/test/java/com/example/voiceinput/FlickKeyboardViewTest.kt`
- Modify: `app/src/main/java/com/example/voiceinput/TabBarManager.kt:8`
- Modify: `app/src/main/res/layout/ime_voice_input.xml:83-96,130-136`
- Modify: `app/src/main/java/com/example/voiceinput/VoiceInputIME.kt` (multiple locations)

**Step 1: Delete FlickKeyboard files**

```bash
rm app/src/main/java/com/example/voiceinput/FlickKeyboardView.kt
rm app/src/test/java/com/example/voiceinput/FlickKeyboardViewTest.kt
```

**Step 2: Rename TAB_INPUT in TabBarManager.kt**

Change line 8:
```kotlin
const val TAB_TMUX = 2
```

**Step 3: Update ime_voice_input.xml**

Change tabInput text from "INPUT" to "TMUX" (line 88):
```xml
android:text="TMUX"
```

Remove flickKeyboard element (lines 130-136). Replace with TmuxView placeholder (will be created in Task 3):
```xml
        <!-- TMUXモード（デフォルト非表示） -->
        <com.example.voiceinput.TmuxView
            android:id="@+id/tmuxView"
            android:layout_width="match_parent"
            android:layout_height="250dp"
            android:visibility="gone" />
```

**Step 4: Clean up VoiceInputIME.kt**

Remove fields:
- `private var isFlickMode = false` (line 30)
- `private var flickKeyboard: FlickKeyboardView? = null` (line 32)
- `private var composingBuffer = StringBuilder()` (line 39)

Remove flickKeyboard initialization (line 60):
```kotlin
// DELETE: flickKeyboard = view.findViewById(R.id.flickKeyboard)
```

Remove entire FlickKeyboardListener setup (lines 83-136).

Replace tab dispatch (line 159):
```kotlin
TabBarManager.TAB_TMUX -> showTmuxContent()
```

Replace tab click handler:
```kotlin
tabInput?.setOnClickListener { animateTabSelection(TabBarManager.TAB_TMUX) }
```

Replace `showFlickKeyboardContent()` (lines 607-613) with:
```kotlin
private fun showTmuxContent() {
    voiceModeArea?.visibility = View.GONE
    commandLearning?.visibility = View.GONE
    tmuxView?.visibility = View.VISIBLE
    contentFrame?.setBackgroundColor(0xFF111418.toInt())
}
```

Update `showVoiceModeContent()` — remove `isFlickMode`/`composingBuffer` lines, replace `flickKeyboard` with `tmuxView`:
```kotlin
private fun showVoiceModeContent() {
    tmuxView?.visibility = View.GONE
    commandLearning?.visibility = View.GONE
    voiceModeArea?.visibility = View.VISIBLE
    contentFrame?.setBackgroundColor(0)
}
```

Update `showLearningModeContent()` — replace `flickKeyboard` with `tmuxView`:
```kotlin
private fun showLearningModeContent() {
    voiceModeArea?.visibility = View.GONE
    tmuxView?.visibility = View.GONE
    commandLearning?.visibility = View.VISIBLE
    commandLearning?.refreshCommandList()
    contentFrame?.setBackgroundColor(0xFF111418.toInt())
}
```

Delete `showFlickKeyboard()` method (lines 636-638).

Remove `showKanjiCandidatePopup()` method entirely (uses flickKeyboard as anchor).

Remove `composingBuffer.clear()` from `onStartInput()`.

Add field:
```kotlin
private var tmuxView: TmuxView? = null
```

Add initialization (placeholder, TmuxView created in Task 3):
```kotlin
// tmuxView = view.findViewById(R.id.tmuxView)
```

**Step 5: Build to verify compilation**

Note: Build will fail until TmuxView is created in Task 3. Create a minimal stub:

Create `app/src/main/java/com/example/voiceinput/TmuxView.kt`:
```kotlin
package com.example.voiceinput

import android.content.Context
import android.util.AttributeSet
import android.widget.FrameLayout

class TmuxView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null
) : FrameLayout(context, attrs)
```

Run: `./gradlew testDebugUnitTest`
Expected: BUILD SUCCESSFUL (FlickKeyboardViewTest deleted, no flick references remain)

**Step 6: Commit**

```bash
git add -A
git commit -m "refactor: replace INPUT tab with TMUX tab, delete FlickKeyboard"
```

---

### Task 2: Add SshContextProvider.sendKeys()

**Files:**
- Modify: `app/src/main/java/com/example/voiceinput/SshContextProvider.kt`
- Create: `app/src/test/java/com/example/voiceinput/SshSendKeysTest.kt`

**Step 1: Write failing tests**

```kotlin
package com.example.voiceinput

import org.junit.Assert.*
import org.junit.Test

class SshSendKeysTest {

    @Test
    fun `buildSendKeysCommand with session and simple key`() {
        val cmd = SshContextProvider.buildSendKeysCommand("dev", "Enter")
        assertEquals(
            "export PATH=\$PATH:/opt/homebrew/bin:/usr/local/bin; tmux send-keys -t dev Enter",
            cmd
        )
    }

    @Test
    fun `buildSendKeysCommand with digit key`() {
        val cmd = SshContextProvider.buildSendKeysCommand("dev", "5")
        assertEquals(
            "export PATH=\$PATH:/opt/homebrew/bin:/usr/local/bin; tmux send-keys -t dev 5",
            cmd
        )
    }

    @Test
    fun `buildSendKeysCommand without session`() {
        val cmd = SshContextProvider.buildSendKeysCommand("", "Up")
        assertEquals(
            "export PATH=\$PATH:/opt/homebrew/bin:/usr/local/bin; tmux send-keys Up",
            cmd
        )
    }

    @Test
    fun `buildCaptureCommand with 20 lines`() {
        val cmd = SshContextProvider.buildCaptureCommand("dev", 20)
        assertTrue(cmd.contains("tmux capture-pane -t dev -p -S -20"))
    }
}
```

**Step 2: Run tests to verify they fail**

Run: `./gradlew testDebugUnitTest --tests "com.example.voiceinput.SshSendKeysTest"`
Expected: FAIL — methods don't exist

**Step 3: Implement**

Add to `SshContextProvider.companion`:

```kotlin
        fun buildSendKeysCommand(tmuxSession: String, key: String): String {
            val target = if (tmuxSession.isBlank()) "" else " -t $tmuxSession"
            return "export PATH=\$PATH:/opt/homebrew/bin:/usr/local/bin; tmux send-keys$target $key"
        }

        fun buildCaptureCommand(tmuxSession: String, lines: Int): String {
            val target = if (tmuxSession.isBlank()) "" else " -t $tmuxSession"
            return "export PATH=\$PATH:/opt/homebrew/bin:/usr/local/bin; tmux capture-pane$target -p -S -$lines"
        }
```

Add instance method:

```kotlin
    fun sendKeys(key: String) {
        val session = getOrCreateSession()
        val channel = session.openChannel("exec") as ChannelExec
        channel.setCommand(buildSendKeysCommand(tmuxSession, key))
        channel.connect(CONNECT_TIMEOUT_MS)
        channel.disconnect()
    }

    fun fetchLines(lines: Int): String? {
        val session = getOrCreateSession()
        val channel = session.openChannel("exec") as ChannelExec
        channel.setCommand(buildCaptureCommand(tmuxSession, lines))
        channel.inputStream.use { input ->
            channel.connect(CONNECT_TIMEOUT_MS)
            val output = input.bufferedReader().readText()
            channel.disconnect()
            return parseOutput(output)
        }
    }
```

**Step 4: Run tests**

Run: `./gradlew testDebugUnitTest --tests "com.example.voiceinput.SshSendKeysTest"`
Expected: All 4 tests PASS

**Step 5: Commit**

```bash
git add app/src/main/java/com/example/voiceinput/SshContextProvider.kt app/src/test/java/com/example/voiceinput/SshSendKeysTest.kt
git commit -m "feat: add sendKeys and fetchLines to SshContextProvider"
```

---

### Task 3: Create TmuxView with layout and keyboard

**Files:**
- Create: `app/src/main/res/layout/view_tmux.xml`
- Modify: `app/src/main/java/com/example/voiceinput/TmuxView.kt` (replace stub)

**Step 1: Create view_tmux.xml**

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="#111418">

    <!-- tmux output area -->
    <ScrollView
        android:id="@+id/tmuxScrollView"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:padding="8dp">

        <TextView
            android:id="@+id/tmuxOutput"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:textColor="#E6EDF3"
            android:textSize="10sp"
            android:fontFamily="monospace"
            android:lineSpacingExtra="2dp" />

    </ScrollView>

    <!-- separator -->
    <View
        android:layout_width="match_parent"
        android:layout_height="1dp"
        android:background="#2B323C" />

    <!-- keyboard row -->
    <LinearLayout
        android:id="@+id/tmuxKeyboard"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:background="#1A1F26"
        android:padding="4dp"
        android:gravity="center_vertical" />

</LinearLayout>
```

**Step 2: Implement TmuxView.kt**

Replace the stub with:

```kotlin
package com.example.voiceinput

import android.content.Context
import android.graphics.Typeface
import android.os.Handler
import android.os.Looper
import android.util.AttributeSet
import android.view.Gravity
import android.view.LayoutInflater
import android.widget.FrameLayout
import android.widget.LinearLayout
import android.widget.ScrollView
import android.widget.TextView
import kotlinx.coroutines.*

interface TmuxViewListener {
    fun onSendKeys(key: String)
    fun onRequestRefresh(callback: (String?) -> Unit)
}

class TmuxView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null
) : FrameLayout(context, attrs) {

    companion object {
        private const val POLL_INTERVAL_MS = 2000L
        private const val COLOR_KEY_BG = 0xFF1A1F26.toInt()
        private const val COLOR_KEY_TEXT = 0xFF8B949E.toInt()
        private const val COLOR_KEY_ACCENT = 0xFF6BA4FF.toInt()
        private const val COLOR_BORDER = 0xFF2B323C.toInt()

        val KEYS = listOf(
            "\u2191" to "Up",      // ↑
            "\u2193" to "Down",    // ↓
            "0" to "0", "1" to "1", "2" to "2", "3" to "3", "4" to "4",
            "5" to "5", "6" to "6", "7" to "7", "8" to "8", "9" to "9",
            "\u232B" to "BSpace",  // ⌫
            "\u23CE" to "Enter"    // ⏎
        )
    }

    var listener: TmuxViewListener? = null
    private var tmuxOutput: TextView? = null
    private var tmuxScrollView: ScrollView? = null
    private val handler = Handler(Looper.getMainLooper())
    private var polling = false

    private val pollRunnable = object : Runnable {
        override fun run() {
            if (!polling) return
            listener?.onRequestRefresh { text ->
                post {
                    tmuxOutput?.text = text ?: ""
                    tmuxScrollView?.fullScroll(ScrollView.FOCUS_DOWN)
                }
            }
            handler.postDelayed(this, POLL_INTERVAL_MS)
        }
    }

    init {
        val view = LayoutInflater.from(context).inflate(R.layout.view_tmux, this, true)
        tmuxOutput = view.findViewById(R.id.tmuxOutput)
        tmuxScrollView = view.findViewById(R.id.tmuxScrollView)

        val keyboard = view.findViewById<LinearLayout>(R.id.tmuxKeyboard)
        buildKeyboard(keyboard)
    }

    private fun buildKeyboard(container: LinearLayout) {
        val dp = { value: Int -> (value * context.resources.displayMetrics.density).toInt() }

        for ((label, key) in KEYS) {
            val btn = TextView(context).apply {
                text = label
                setTextColor(if (key == "Enter") COLOR_KEY_ACCENT else COLOR_KEY_TEXT)
                textSize = 11f
                typeface = Typeface.MONOSPACE
                gravity = Gravity.CENTER
                setPadding(0, dp(8), 0, dp(8))
                layoutParams = LinearLayout.LayoutParams(0, LinearLayout.LayoutParams.WRAP_CONTENT, 1f)
                setOnClickListener { listener?.onSendKeys(key) }
            }
            container.addView(btn)
        }
    }

    fun startPolling() {
        if (polling) return
        polling = true
        handler.post(pollRunnable)
    }

    fun stopPolling() {
        polling = false
        handler.removeCallbacks(pollRunnable)
    }

    fun updateOutput(text: String?) {
        tmuxOutput?.text = text ?: ""
        tmuxScrollView?.fullScroll(ScrollView.FOCUS_DOWN)
    }

    override fun onDetachedFromWindow() {
        super.onDetachedFromWindow()
        stopPolling()
    }
}
```

**Step 3: Run tests and build**

Run: `./gradlew testDebugUnitTest`
Expected: BUILD SUCCESSFUL

**Step 4: Commit**

```bash
git add app/src/main/res/layout/view_tmux.xml app/src/main/java/com/example/voiceinput/TmuxView.kt
git commit -m "feat: create TmuxView with tmux output display and keyboard row"
```

---

### Task 4: Wire TmuxView into VoiceInputIME

**Files:**
- Modify: `app/src/main/java/com/example/voiceinput/VoiceInputIME.kt`

**Step 1: Add tmuxView field and initialization**

Add field:
```kotlin
private var tmuxView: TmuxView? = null
```

In `onCreateInputView()`, after other view initializations:
```kotlin
tmuxView = view.findViewById(R.id.tmuxView)
tmuxView?.listener = object : TmuxViewListener {
    override fun onSendKeys(key: String) {
        serviceScope.launch(Dispatchers.IO) {
            try {
                sshContextProvider?.sendKeys(key)
                // Refresh display after sending key
                delay(100)
                val text = sshContextProvider?.fetchLines(20)
                withContext(Dispatchers.Main) {
                    tmuxView?.updateOutput(text)
                }
            } catch (e: Exception) {
                // Silently ignore SSH errors
            }
        }
    }

    override fun onRequestRefresh(callback: (String?) -> Unit) {
        serviceScope.launch(Dispatchers.IO) {
            val text = try {
                sshContextProvider?.fetchLines(20)
            } catch (e: Exception) {
                null
            }
            withContext(Dispatchers.Main) {
                callback(text)
            }
        }
    }
}
```

**Step 2: Update showTmuxContent() to start polling**

```kotlin
private fun showTmuxContent() {
    voiceModeArea?.visibility = View.GONE
    commandLearning?.visibility = View.GONE
    tmuxView?.visibility = View.VISIBLE
    contentFrame?.setBackgroundColor(0xFF111418.toInt())
    tmuxView?.startPolling()
}
```

**Step 3: Stop polling when leaving TMUX tab**

In `showVoiceModeContent()` and `showLearningModeContent()`, add:
```kotlin
tmuxView?.stopPolling()
```

**Step 4: Run tests and build**

Run: `./gradlew testDebugUnitTest`
Expected: BUILD SUCCESSFUL

**Step 5: Commit**

```bash
git add app/src/main/java/com/example/voiceinput/VoiceInputIME.kt
git commit -m "feat: wire TmuxView into IME with SSH key sending and polling"
```

---

### Task 5: Add ntfy.sh settings to PreferencesManager and MainActivity

**Files:**
- Modify: `app/src/main/java/com/example/voiceinput/PreferencesManager.kt`
- Modify: `app/src/main/res/layout/activity_main.xml`
- Modify: `app/src/main/res/values/strings.xml`
- Modify: `app/src/main/java/com/example/voiceinput/MainActivity.kt`
- Test: `app/src/test/java/com/example/voiceinput/PreferencesManagerTest.kt`

**Step 1: Write failing test**

Add to existing `PreferencesManagerTest.kt`:

```kotlin
    @Test
    fun `save and get ntfy topic`() {
        prefsManager.saveNtfyTopic("my-voice-input")
        assertEquals("my-voice-input", prefsManager.getNtfyTopic())
    }

    @Test
    fun `ntfy topic defaults to empty string`() {
        assertEquals("", prefsManager.getNtfyTopic())
    }
```

**Step 2: Implement PreferencesManager changes**

Add constant:
```kotlin
private const val KEY_NTFY_TOPIC = "ntfy_topic"
```

Add methods:
```kotlin
fun saveNtfyTopic(topic: String) { prefs.edit().putString(KEY_NTFY_TOPIC, topic).apply() }
fun getNtfyTopic(): String = prefs.getString(KEY_NTFY_TOPIC, "") ?: ""
```

**Step 3: Add string resources**

In `strings.xml`:
```xml
<string name="ntfy_settings_title">通知設定</string>
<string name="ntfy_topic_hint">ntfy.sh トピック名</string>
<string name="ntfy_saved">通知設定を保存しました</string>
```

**Step 4: Add UI to activity_main.xml**

After SSH settings section, add:
```xml
        <!-- ntfy.sh Settings -->
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="@string/ntfy_settings_title"
            android:textSize="18sp"
            android:layout_marginTop="32dp"
            android:textStyle="bold" />

        <com.google.android.material.textfield.TextInputLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="@string/ntfy_topic_hint"
            android:layout_marginTop="8dp">
            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/ntfyTopicInput"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text" />
        </com.google.android.material.textfield.TextInputLayout>

        <com.google.android.material.button.MaterialButton
            android:id="@+id/ntfySaveButton"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="@string/ntfy_saved"
            android:layout_marginTop="8dp" />
```

**Step 5: Wire up in MainActivity.kt**

Add `setupNtfySettings()` method:
```kotlin
private fun setupNtfySettings() {
    val topicInput = findViewById<EditText>(R.id.ntfyTopicInput)
    val saveButton = findViewById<Button>(R.id.ntfySaveButton)

    prefsManager.getNtfyTopic().let { if (it.isNotEmpty()) topicInput.setText(it) }

    saveButton.setOnClickListener {
        prefsManager.saveNtfyTopic(topicInput.text.toString().trim())
        Toast.makeText(this, R.string.ntfy_saved, Toast.LENGTH_SHORT).show()
    }
}
```

Call from `onCreate()`.

**Step 6: Run tests and commit**

Run: `./gradlew testDebugUnitTest`

```bash
git add -A
git commit -m "feat: add ntfy.sh topic setting to preferences and settings UI"
```

---

### Task 6: Implement ntfy.sh SSE listener

**Files:**
- Create: `app/src/main/java/com/example/voiceinput/NtfyListener.kt`
- Modify: `app/build.gradle.kts` (add okhttp-sse dependency)
- Modify: `app/src/main/java/com/example/voiceinput/VoiceInputIME.kt`

**Step 1: Add okhttp-sse dependency**

In `app/build.gradle.kts`:
```kotlin
implementation("com.squareup.okhttp3:okhttp-sse:4.12.0")
```

**Step 2: Create NtfyListener.kt**

```kotlin
package com.example.voiceinput

import okhttp3.OkHttpClient
import okhttp3.Request
import okhttp3.Response
import okhttp3.sse.EventSource
import okhttp3.sse.EventSourceListener
import okhttp3.sse.EventSources
import java.util.concurrent.TimeUnit

class NtfyListener(
    private val topic: String,
    private val onNotification: (String) -> Unit
) {
    private var eventSource: EventSource? = null
    private val client = OkHttpClient.Builder()
        .readTimeout(0, TimeUnit.SECONDS)
        .build()

    fun start() {
        if (topic.isBlank()) return
        val request = Request.Builder()
            .url("https://ntfy.sh/$topic/sse")
            .build()

        val factory = EventSources.createFactory(client)
        eventSource = factory.newEventSource(request, object : EventSourceListener() {
            override fun onEvent(eventSource: EventSource, id: String?, type: String?, data: String) {
                onNotification(data)
            }
            override fun onFailure(eventSource: EventSource, t: Throwable?, response: Response?) {
                // Reconnect after delay
                android.os.Handler(android.os.Looper.getMainLooper()).postDelayed({
                    stop()
                    start()
                }, 5000)
            }
        })
    }

    fun stop() {
        eventSource?.cancel()
        eventSource = null
    }
}
```

**Step 3: Wire into VoiceInputIME**

Add field:
```kotlin
private var ntfyListener: NtfyListener? = null
```

In `refreshSshProvider()` or a new `refreshNtfyListener()`:
```kotlin
private fun refreshNtfyListener() {
    ntfyListener?.stop()
    val topic = PreferencesManager(
        getSharedPreferences("voice_input_prefs", MODE_PRIVATE)
    ).getNtfyTopic()
    if (topic.isNotBlank()) {
        ntfyListener = NtfyListener(topic) { message ->
            runOnMainThread {
                showTmuxNotification()
            }
        }
        ntfyListener?.start()
    }
}

private fun runOnMainThread(block: () -> Unit) {
    android.os.Handler(android.os.Looper.getMainLooper()).post(block)
}
```

Call `refreshNtfyListener()` from `onCreateInputView()`.

In `onDestroy()`:
```kotlin
ntfyListener?.stop()
```

Add placeholder:
```kotlin
private fun showTmuxNotification() {
    // Will be implemented in Task 7
}
```

**Step 4: Run tests and commit**

Run: `./gradlew testDebugUnitTest`

```bash
git add -A
git commit -m "feat: add ntfy.sh SSE listener for Claude Code approval notifications"
```

---

### Task 7: Tab notification animation (green dot blink)

**Files:**
- Modify: `app/src/main/res/layout/ime_voice_input.xml` (wrap tabInput in FrameLayout with dot)
- Modify: `app/src/main/java/com/example/voiceinput/VoiceInputIME.kt`

**Step 1: Add notification dot to TMUX tab in layout**

Replace the tabInput TextView in `ime_voice_input.xml` with a FrameLayout containing the tab text + dot:

```xml
        <FrameLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginStart="4dp">

            <TextView
                android:id="@+id/tabInput"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="TMUX"
                android:textSize="10sp"
                android:letterSpacing="0.2"
                android:gravity="center"
                android:padding="8dp"
                android:elevation="6dp"
                android:background="@drawable/bg_tab_unselected"
                android:textColor="#8B949E" />

            <View
                android:id="@+id/tmuxNotificationDot"
                android:layout_width="6dp"
                android:layout_height="6dp"
                android:layout_gravity="top|end"
                android:layout_marginTop="4dp"
                android:layout_marginEnd="8dp"
                android:background="@drawable/dot_filled"
                android:backgroundTint="#4ADE80"
                android:visibility="gone" />

        </FrameLayout>
```

**Step 2: Implement notification in VoiceInputIME**

Add field:
```kotlin
private var notificationDot: View? = null
private var notificationAnimator: ObjectAnimator? = null
```

Initialize in `onCreateInputView()`:
```kotlin
notificationDot = view.findViewById(R.id.tmuxNotificationDot)
```

Implement `showTmuxNotification()`:
```kotlin
private fun showTmuxNotification() {
    notificationDot?.visibility = View.VISIBLE
    notificationAnimator?.cancel()
    notificationAnimator = ObjectAnimator.ofFloat(notificationDot, "alpha", 0f, 1f).apply {
        duration = 500
        repeatMode = ObjectAnimator.REVERSE
        repeatCount = ObjectAnimator.INFINITE
        start()
    }
}

private fun clearTmuxNotification() {
    notificationAnimator?.cancel()
    notificationDot?.alpha = 1f
    notificationDot?.visibility = View.GONE
}
```

Call `clearTmuxNotification()` in `showTmuxContent()` (when user taps TMUX tab).

Add `import android.animation.ObjectAnimator` to imports.

**Step 3: Run tests and build**

Run: `./gradlew testDebugUnitTest`
Expected: BUILD SUCCESSFUL

**Step 4: Commit**

```bash
git add -A
git commit -m "feat: add green dot blink notification on TMUX tab"
```

---

### Task 8: Build, verify, and sync APK

**Step 1: Run all unit tests**

Run: `./gradlew testDebugUnitTest`
Expected: All tests PASS

**Step 2: Build debug APK**

Run: `./gradlew assembleDebug`
Expected: BUILD SUCCESSFUL

**Step 3: Copy APK**

```bash
cp app/build/outputs/apk/debug/app-debug.apk ~/Sync/APK/voice-input.apk
```

**Step 4: Verify checklist**
- [ ] TMUX タブ表示、INPUT タブなし
- [ ] tmux出力が2秒ポーリングで更新
- [ ] キーボード1行: ↑↓0-9⌫⏎ がSSH経由で動作
- [ ] 設定画面に ntfy トピック入力欄
- [ ] ntfy 通知で緑丸明滅
- [ ] タブタップで通知クリア

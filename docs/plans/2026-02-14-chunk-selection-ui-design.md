# 差分ハイライト＋候補選択UI 設計

## 概要

音声入力後、GPT変換結果を自動入力しつつ、Whisper原文との差分をチャンク単位でハイライト表示。ユーザーがタップして原文版に切り替えられる。

## データフロー

1. マイク長押し → 録音
2. 離す → Whisper transcribe → 生テキスト
3. GPTに送信（プロンプト変更済み）→ JSON配列で返却
   ```json
   [{"raw":"ギット","converted":"git"}, {"raw":"ステータス","converted":"status"}]
   ```
4. converted部分を結合して `commitText()` で入力
5. IMEパネルに候補バーを表示:
   - 各チャンクをボタンとして横並び
   - `raw ≠ converted` のチャンクだけハイライト（背景色変更）
   - ハイライトをタップ → raw版が候補としてポップアップ
   - 候補選択 → 入力済みテキストの該当部分を差し替え
6. 次の録音開始 or タイムアウトで候補バークリア

## UIレイアウト

```
┌─────────────────────────────────────────────┐
│ [ギット→git] [ステータス→status]   🎤   ⌨   │
│  ↑ハイライト   ↑ハイライト                    │
│                                             │
│  タップ → [ギット] [git] から選択             │
└─────────────────────────────────────────────┘
```

- 候補バー: HorizontalScrollView内にチャンクボタンを動的生成
- ハイライトチャンク: 色付き背景（タップ可能）
- 一致チャンク: グレー背景（タップ不要）
- マイクボタン・キーボード切替: 右端固定

## GPTプロンプト変更

現在の「変換結果のみ返す」→「JSON配列で raw/converted ペアを返す」に変更。

フォールバック: JSONパース失敗時は従来通り文字列全体を1チャンクとして扱う。

## テキスト差し替え

チャンクの位置（文字数オフセット）を記録し、タップ時に:
1. `deleteSurroundingText()` で該当範囲を削除
2. `commitText()` で選択した版を挿入
3. 後続チャンクのオフセットを再計算

## 変更ファイル

| ファイル | 操作 |
|---------|------|
| `GptConverter.kt` | プロンプト変更、JSON配列パース |
| `VoiceInputProcessor.kt` | `ConversionChunk` データクラス追加、戻り値変更 |
| `VoiceInputIME.kt` | 候補バーUI、タップ→差し替えロジック |
| `ime_voice_input.xml` | 候補バー用ScrollView追加 |
| テスト各種 | 上記に対応 |
